# core/service

## 文件说明

core/service 目录为工具服务的核心部分，UI 部分会基于此构建。service 文件夹本身不提供 index 作为总入口，因为这可能导致页面一次性引入所有服务，增加体积。但是，因为如路由、功能搜索等部分需要一个统一的服务信息源，所以提供 schema 文件。各个服务的 schema 只会提供部分功能，并且主要功能动态导入，有助于控制体积。

service 里不弹出错误提示，错误提示由页面处理。错误一般通过 reject(CoreError) 或者 reject(Error) 抛出。回调里通过返回值抛出。

service/xxx/ 下的文件（夹）：

- index 是工具服务的入口，功能导出文件。UI 会调用这个文件使用功能。

- core 是核心功能，不涉及多语言、UI、错误提示等。core 可以没有。

- schema 是服务概要，实际上就是用一个对象表示服务提供的功能。该模块每个服务都要有，可以描述丰富，提供可编排功能，也可以只包含名称、图标、关键字、描述。schema 可引入 index 的功能，也可以直接从 core 引入。功能编排依据此文件。每个暴露的功能都是一个 async 函数。编排器、执行器会提供环境参数，包括完成回调，错误回调。

  - components 功能编排要用到的组件。比如输入表单等。

  - [module].ts 功能文件。

- utils 是内部工具文件（当然，其他地方也可以调用。但通用的函数更建议放在 service/core 下的 utils 里）。

- worker 是多线程文件。可以被 core，schema, index 等使用，也可以引用 core。

- data-types 是服务特有的数据类型——比如用于 schema input 和 output，不是函数实际的输出格式。

## 功能设计实现

- 资源采用 jszip 的数据格式，key 为路径，value 为数据描述。

- 内部资源自定义后缀——js\_[type]

- 功能针对资源进行处理

- 功能是否可编排需要显式标记

- 功能参数设置表单由功能自行实现。建议，输入资源可默认绑定参数，被绑定参数不可设置。如不默认绑定，可绑定参数设置单选功能。参数可以在编排时和运行时设定，编排时非输入资源参数无需必填。设定参数完成后，调编排器的 paramsDone 完成该节点设置。

- 功能可以有多种输入输出。

- 功能输入输出尽量为已知文件资源，即使存在重复编解码也没关系，降低实现难度。

- 编排器只进行初步格式校验，符合格式的才可以作为下一个节点。

- 执行器
